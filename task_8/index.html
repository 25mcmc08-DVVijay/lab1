<!DOCTYPE html>
<html>
<head>
    <title>Assignment #8 - XML to JSON using jQuery</title>


    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        h2, h3 {
            text-align: center;
        }

        .filters {
            margin-bottom: 15px;
            text-align: center;
        }

        select, input, button {
            padding: 6px;
            margin: 5px;
        }

        table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 20px;
        }

        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: center;
        }

        th {
            background-color: lightgray;
        }

        tr:hover {
            background-color: #f2f2f2;
        }
    </style>
</head>

<body>

<h2>Book Catalog</h2>

<h3>Filter Books</h3>

<div class="filters">
    <select id="genreFilter">
        <option value="All">All Genres</option>
    </select>

    <select id="authorFilter">
        <option value="All">All Authors</option>
    </select>

    <input type="number" id="minPrice" placeholder="Min Price">
    <input type="number" id="maxPrice" placeholder="Max Price">

    <button id="applyFilter">Apply Filter</button>
</div>

<table id="bookTable">
    <thead>
        <tr>
            <th>Title</th>
            <th>Author</th>
            <th>Genre</th>
            <th>Price</th>
            <th>Publish Date</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<script>

let booksJSON = [];

$(document).ready(function() {

    $.ajax({
        url: "books.xml",
        dataType: "xml",
        success: function(data) {

            $(data).find("book").each(function() {

                let book = {
                    title: $(this).find("title").text(),
                    author: $(this).find("author").text(),
                    genre: $(this).find("genre").text(),
                    price: parseFloat($(this).find("price").text()),
                    publish_date: $(this).find("publish_date").text()
                };

                booksJSON.push(book);
            });

            populateFilters();
            displayTable(booksJSON);
        },

        error: function() {
            alert("Error loading XML file. Please run using Live Server.");
        }
    });

    $("#applyFilter").click(function() {
        applyFilters();
    });

});


function populateFilters() {

    let genres = new Set();
    let authors = new Set();

    booksJSON.forEach(book => {
        genres.add(book.genre);
        authors.add(book.author);
    });

    genres.forEach(g => {
        $("#genreFilter").append(`<option value="${g}">${g}</option>`);
    });

    authors.forEach(a => {
        $("#authorFilter").append(`<option value="${a}">${a}</option>`);
    });
}


function displayTable(data) {

    $("#bookTable tbody").empty();

    $.each(data, function(index, book) {

        let row = `
            <tr>
                <td>${book.title}</td>
                <td>${book.author}</td>
                <td>${book.genre}</td>
                <td>${book.price}</td>
                <td>${book.publish_date}</td>
            </tr>
        `;

        $("#bookTable tbody").append(row);
    });
}


function applyFilters() {

    let genre = $("#genreFilter").val();
    let author = $("#authorFilter").val();
    let min = parseFloat($("#minPrice").val()) || 0;
    let max = parseFloat($("#maxPrice").val()) || Infinity;

    let filtered = booksJSON.filter(book => {

        return (genre === "All" || book.genre === genre) &&
               (author === "All" || book.author === author) &&
               (book.price >= min && book.price <= max);
    });

    displayTable(filtered);
}

</script>

</body>
</html>